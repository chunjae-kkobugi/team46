<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{include/head :: head}"></th:block>
    <title th:text="${detail.title}"></title>

    <link rel="stylesheet" th:src="@{/js/jqeury-ui-1.13.2/jquery-ui.css}">
    <link rel="stylesheet" th:src="@{/js/jqeury-ui-1.13.2/jquery-ui.strucutre.css}">
    <link rel="stylesheet" th:src="@{/js/jqeury-ui-1.13.2/jquery-ui.theme.css}">

    <script th:src="@{/js/jquery-3.4.1.min.js}"></script>
    <script th:src="@{/js/sockjs.min.js}"></script>
    <script th:src="@{/js/stomp.min.js}"></script>
    <script th:src="@{/js/jquery-ui-1.13.2/jquery-ui.js}"></script>

    <style>
        /* 겉부분의 디자인 변경 */
        input[type=color] {
            width: 57px;
            height: 45px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: transparent;
            border: none;
        }

        /* 안쪽부분의 디자인 변경 */
        input[type=color]::-webkit-color-swatch {
            border-radius: 30px;
            border: 5px solid;
        }

        .register {
            display: none;
        }

        #boardMenuList {
            position: absolute;
            right: 0;
            top: 50px;
            display: none;
            width: auto;
            height: auto;
            border: 1px solid rgb(175 174 174);
            border-radius: 20px;
            background-color: #eeeeee
        }

        #postMenuList {
            border-radius: 20px;
            position: absolute;
            right: -112px;
            display: none;
            height: auto;
            border: 1px solid rgb(175 174 174);
            background-color: #eeeeee;
            z-index: 10;
            width: 110px;
        }

        .xBtn i {
            position: absolute;
            right: -12px;
            top: -15px;
            cursor: pointer;
        }
        .register {
            display: none;
            position: relative;
        }
        #sortable { list-style-type: none; /*margin: 1rem; padding: 0; width: 350px; */}
        #sortable li { float: left;/*margin: 3px 3px 3px 0; padding: 1px; float: left; width: 100px; height: 90px; font-size: 20px; text-align: center; border: 1px solid black;*/}
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
<th:block th:replace="~{include/header :: header}" class="mb-0"></th:block>
<section class="section pb-5" th:style="'background-color : '+ ${detail.bgColor}">
    <div class="mt-4 pb-3 " style="border-bottom: 1px solid rgb(175 174 174)">
        <div class="row justify-content-between">
            <div class="col-6">
                <h1 th:text="${detail.title}" class="ms-5"></h1>
            </div>
            <!-- 포스트잇 등록 슬라이드 메뉴 -->
            <div class="col-6 pe-5 text-end" style="position: relative; z-index: 10">
                <div style="margin-left: 125px"><i class="fas fa-plus-circle fa-3x" style="color: #51B56D; cursor: pointer" id="boardMenu"></i></div>
                <div id="boardMenuList" class="me-5 mt-3 p-2 pb-0 pt-3">
                    <ul class="p-0" style="list-style-type: none">
                        <li><button type="button" id="postRegisterBtn" class="btn btn-outline-main mb-2">포스트잇 쓰기</button></li>
                        <li><a th:href="@{/}" class="btn btn-outline-main mb-2" style="width: 100%">게시판 수정</a></li>
                    </ul>
                </div>
            </div>
            <!-- 포스트잇 등록 슬라이드 메뉴 -->
        </div>
    </div>
    <div class="post" style="min-height: 700px;">
        <div class="container-fluid m-0 row">
            <ul id="sortable" class="col-12 ui-sortable">
                <li class="col-2 mb-3 mt-2 ui-sortable-handle ui-state-default" th:each="p, status : ${postList}" th:id="${p.pno}" th:pno="${p.pno}">
                    <div class="m-2">
                        <div class="card shadow-sm">
                            <!-- 포스트잇 메뉴 버튼 -->
                            <i class="fa-solid fa-ellipsis-vertical" th:id="'postMenuBtn'+${status.count}"
                               style="position: absolute; top: 10px; right: 10px; mix-blend-mode: difference; color: #eeeeee; cursor: pointer"></i>
                            <div th:id="postMenuList+${status.count}" class="p-2"
                                 style="border-radius: 20px; position: absolute; right: -112px; display: none; height: auto;
                                 border: 1px solid rgb(175 174 174); background-color: #eeeeee; z-index: 10; width: 110px;">
                                <ul class="p-0" style="list-style-type: none">
                                    <li class="mb-1">
                                        <button type="button" th:id="'postModifyBtn'+${status.count}" class="btn" style="width: 100%; border: 1px solid #b4b4b4;"
                                                th:style="${ p.bgImage eq null ? 'width: 100%; border: 1px solid #b4b4b4; background-color : ' + p.bgColor : 'width: 100%; border: 1px solid #b4b4b4;' }">
                                            <span style="color: #eeeeee; mix-blend-mode: difference;" th:style="${p.bgColor eq '#ffffff' || p.bgColor eq null ? 'color : #333333' : 'mix-blend-mode: difference; color : #eeeeee'}">수정</span>
                                        </button>
                                    </li>
                                    <li><button type="button" th:id="'postRemoveBtn'+${status.count}" class="btn" style="width: 100%; border: 1px solid #b4b4b4"
                                                th:style="${ p.bgImage eq null ? 'width: 100%; border: 1px solid #b4b4b4; background-color : ' + p.bgColor : 'width: 100%; border: 1px solid #b4b4b4;' }">
                                        <span style="color: #eeeeee; mix-blend-mode: difference;" th:style="${p.bgColor eq '#ffffff' || p.bgColor eq null ? 'color : #333333' : 'mix-blend-mode: difference; color : #eeeeee'}">삭제</span>
                                    </button></li>
                                </ul>
                            </div>
                            <div class="card-body" th:style="${ p.bgImage eq null ? 'background-color : ' + p.bgColor : null }">
                                <div class="text-body" style="height: 200px;">
                                    <p class="card-text" th:text="${p.content}" style="mix-blend-mode: difference; color: #eeeeee; font-size: 20px;"></p>
                                </div>
                                <div class="d-flex justify-content-between row">
                                    <p class="card-text text-end mb-0" style="mix-blend-mode: exclusion; color: #ffffff" th:text="${p.author}"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <!-- 포스트잇 등록 -->
                <li class="col-2 mb-3 mt-2 register" id="postRegister">
                    <div class="m-2">
                        <div class="card shadow-sm">
                            <div class="card-body" style="height: 258px;">
                                <div class="xBtn">
                                    <i class="fa-2x fa-circle-xmark fa-solid float-end"></i>
                                </div>
                                <!-- 포스트잇 글 등록 -->
                                <form th:action="@{/post/register}" method="post" enctype="multipart/form-data">
                                    <div class="justify-content-center row">
                                        <textarea name="content" type="text" maxlength="1000" class="form-control" placeholder="내용을 입력하세요" style="height: 115px; resize: none;"></textarea>
                                        <input type="hidden" name="bno" id="bno" th:value="${detail.bno}">
                                        <div class="justify-content-between row">
                                            <input type="color" class="col-2 form-control mt-1" name="bgColor" id="bgColor" value="#ffffff">
                                            <input type="file" class="col-9 form-control mb-2 me-2 mt-2 uploadFiles" id="postFile" name="postFile" style="height: auto">
                                        </div>
                                        <div class="btn-group d-flex mt-2">
                                            <button type="submit" class="btn btn-main"> 포스트잇 등록 </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</section>

<script th:inline="javascript">
    const bno = /*[[${detail.bno}]]*/ 1;
    // 게시판 메뉴
    $(document).ready(function(){
        var sw = true;
        sw =! sw;
        $("#boardMenu").click(function () {
            if (sw==true) {
                $("#boardMenuList").slideDown()
                sw = false;
            } else if(sw==false){
                $("#boardMenuList").slideUp()
                sw = true;
            }
        })
    })

    // 포스트잇 글쓰기 영역
    $("#postRegisterBtn").click(function (){
        $("#postRegister").removeClass("register")
    })
    $(".xBtn i").click(function(){
        $("#postRegister").addClass("register")
    })

    // 포스트잇 메뉴
    $(document).ready(function(){
        $('[id^=postMenuBtn]').click(function(){
            var index = this.id.replace('postMenuBtn', ''); // 클릭된 메뉴의 인덱스 추출
            var postMenuList = $("#postMenuList" + index);

            // 현재 메뉴 리스트의 표시 여부를 확인하고 그에 따라 토글합니다.
            if (postMenuList.is(":hidden")) {
                postMenuList.slideDown();
            } else {
                postMenuList.slideUp();
            }
        });
    });
</script>
<th:block th:replace="~{include/footer :: footer}"></th:block>
</body>
<script th:src="@{/js/posts.js}"></script>
<script th:src="@{/js/postJQ-UI.js}"></script>
</html>